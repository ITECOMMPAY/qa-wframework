# Архитектура

Фреймворк представляет собой набор связанных решений для написания UI-тестов на PHP c использованием Codeception.

Среди них:

* Компонентные PageObject'ы. Основная идея фреймворка, ради практической демонстрации которой он и был первоначально написан.
* Генератор тестового проекта. Создаёт структуру каталогов тестового проекта и все необходимые классы.
* Менеджер Селениума. Слегка облегчает жизнь тестировщикам за счёт автоматического скачивания Selenium Server Standalone и свежих драйверов под Chrome и Firefox.
* HTML-логи. Необходимы для связи происходящего на экране с кодом авто-теста.
* Хранилище тестовых данных. Обеспечивает централизованное хранение тестовых данных и настроек.
* Словари псевдонимов. Помогают отвязать тесты от конкретных надписей на странице.
* Интеграция с BrowserStack. Небольшое расширение базового модуля Codeception для прогона тестов в BrowserStack.
* Тестирование вёрстки. Создание скриншотов PageObject'ов и сверка с ними в последующих прогонах тестов. Хранение скриншотов в S3 бакете.
* Мягкие ассерты. Нужны в т.ч. для тестирования вёрстки потому что неразумно валить такой тест на первой обводке с несовпавшим цветом.

## Компонентные PageObject'ы

PageObject'ы делятся на Блоки и Элементы.

Блоки (src/Codeception/Lib/WFramework/WebObjects/Base/WBlock/WBlock.php):
* просто описывают некоторый кусок страницы
* существуют в единственном экземпляре, как и кусок страницы, который они описывают
* не содержат никакой сложной логики - вся их логика снаружи, в тестах

Элементы (src/Codeception/Lib/WFramework/WebObjects/Base/WElement/WElement.php):
* описывают кнопки, поля ввода, календари, таблицы и т.п. элементы страницы
* существуют во множестве экземпляров, каждый из которых имеет свой локатор
* содержат в себе сложную логику, но для тестов предоставляют простой и понятный интерфейс

Блоки состоят из Элементов. Элементы состоят из других элементов.

Все вместе они собраны в дерево через шаблон Composite (src/Codeception/Lib/WFramework/Helpers/Composite.php). Элемент вычисляет свой локатор, относительно родительского Блока или Элемента.

Блоки и Элементы имеют единый интерфейс, который реализован в классе WPageObject (src/Codeception/Lib/WFramework/WebObjects/Base/WPageObject.php). В частности, этот интерфейс содержит is, should и finally методы.

* is-методы проверяют заданное условие для PageObject'а и возвращают true или false.

* finally-методы ожидают выполнения условия в течение некоторого таймаута и возвращают true или false.

* should-методы ожидают выполнения условия в течение некоторого таймаута и валят тест если условие так и не выполнилось.

Помимо блоков и элементов в фреймворке так же имеется псевдо-PageObject под названием Коллекция элементов (src/Codeception/Lib/WFramework/WebObjects/Base/WCollection/WCollection.php). Она позволяет работать с динамической группой веб-элементов которые имеют общий локатор, например с вкладками, пунктами меню, строками таблицы.



## Генератор тестового проекта

TODO

## Менеджер Селениума

TODO

## HTML-логи

TODO

## Хранилище тестовых данных

TODO

## Словари псевдонимов

AliasMap'ы (src/Codeception/Lib/WFramework/AliasMaps/AliasMap.php) - это двухсторонние ассоциативные массивы, где по ключу можно получить значение, а по значению - ключ.
Ключами у нас выступают псевдонимы надписей, а значениями - реальные надписи на странице.

Везде по тестам у нас передаются псевдонимы, а реальные значения извлекаются из AliasMap только в месте непосредственного использования.
Таким образом мы отвязываем наши тесты от реальных надписей на странице.

## Интеграция с BrowserStack

TODO

## Тестирование вёрстки

TODO

## Мягкие ассерты

TODO